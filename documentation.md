# Idea:

Make custom entities easy to implement: items, weapons, pickups, monster etc.

# Functions (the ones in red arent made yet):

### :white_check_mark: void init(bool gameframe) 

inits lib callbacks, if the bool is true then the update callbacks will be called on ON.GAMEFRAME instead of ON.FRAME

### :white_check_mark: void stop()

stops lib callbacks

### :white_check_mark: int id new_custom_entity(function(entity, transition_data) set_func, function(entity, custom_ent_info) updatefunc, optional<CARRY_TYPE> carry_type, optional\<int\> ent_type) 

Set a new custom entity behiavour to be asigned in set_custom_entity()

The function should take care of items being taken to next levels, waddler, etc.

**The set function must return a table** for storing info about the entity, that will be passed to the updatefunc and set_func if the entity can go through levels (items, mounts)

For carry_type, use CARRY_TYPE.HELD or .MOUNT

### :white_check_mark: void set_custom_entity(uid, custom_ent_id)

make a entity to be a custom one

### :red_circle: void spawn_custom_entity(custom_ent_id)

spawn a custom entity

(requires ent_type on custom_ent to be set)

### :white_check_mark: void add_custom_container_chance(custon_ent_id, chance_type, container_type/s)

set the chance of being in a container (only crate, present and ghist present).

The `container_type` can be a a single value or a table of the entity types, use ENT_TYPE.

(requires ent_type on custom_ent to be set)

### :white_check_mark: void add_custom_shop_chance(custom_ent_id, chance_type, shop_type/s)

Add chance to be in a shop or shops, use `SHOP_TYPE` (that uses SHOP_TYPE and ROOM_TEMPLATE from the scripting api) and `CHANCE` from the library

The `shop_type` can be a a single value or a table of the shop types

Only replaces items, not hh or mounts.

(requires ent_type on custom_ent to be set)

### :red_circle: void set_custom_entity_wall_chance(custom_ent_id)

add chance to be incrusted in a block

(requires ent_type on custom_ent to be set)

### :white_check_mark: void set_price(entity, base_price, inflation)

Sets the price of an entity for the level. Use this only in the set function for custom entities, this solves an error that shows when setting the price on the first frame.

### **CHANCE**
- `COMMON` "common"
- `LOW` "low"
- `LOWER` lower"

### **SHOP_TYPE** 
- `GENERAL_STORE` 0
- `CLOTHING_SHOP` 1
- `WEAPON_SHOP` 2
- `SPECIALTY_SHOP` 3
- `HIRED_HAND_SHOP` 4
- `PET_SHOP` 5
- `DICE_SHOP` 6
- `TUSK_DICE_SHOP` 13
- `TUN` 77
- `CAVEMAN` 79

### **CARRY_TYPE**
- `HELD` 1 (items and backpacks)
- `MOUNT` 2
### ALL_SHOPS

A table containing all the shop types

### ALL_CONTAINERS

A table containing crate, present, and ghist present containers

## Extras

### :white_check_mark: int id new_custom_gun(function(entity, transition_data) set_func, function(entity, custom_ent_info) updatefunc, function(entity, facing_left) firefunc, int cooldown, float recoil_x, float recoil_y, optional\<int\> ent_type) )

The script sets the gun cooldown to 2 to prevent the gun from shooting, then handles the cooldown with a variable.

The gun can't be shot by other entities than players.

### :white_check_mark: int id new_custom_gun2(function(entity, transition_data) set_func, function(entity, custom_ent_info) updatefunc, function(weapon_ent, facing_left) bulletfunc, optional\<int\> cooldown, float extra_recoil_x, float extra_recoil_y, ent_type, bool mute_sound)

The script replaces the bullets generated by the weapon, the recoil is the same of the base weapon used.

It can be used by any entity capable of using weapons (Including shopkeepers, hired hands, cavemen, etc.)

Using a shotgun will generate 6 bullets, calling the bulletfunc 6 times and aplying the recoil 6 times, so be careful if you apply an extra recoil to shotguns.

### :white_check_mark: int id new_custom_purchasable_back(function(entity) set_func, function(entity, custom_ent_info) updatefunc, int animation_frame, int toreplace_custom_id, bool flammable)

(WIP) Spawns a rock, and changes some of the properties to make it look like a backpack, spawns the toreplace entity when the item isn't a shop item anymore (bought, shopkeeper angered, etc.)

The custom item that will replace it must have a ent_type assinged.

### :red_circle: int id set_custom_pickup(function() set_func, function() update_holder, optional\<int\> ent_type)

Used for custom pickups, idk if I should add also an update function for updating the item itself.

I'm thinking of making something different for custom pickups, so this might get removed.

### Notes for myself:

https://github.com/spelunky-fyi/overlunky/blob/main/examples/customized_crate_drops.lua

